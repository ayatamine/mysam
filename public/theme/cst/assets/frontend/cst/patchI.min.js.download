function delete_cookie(n,t,i){get_cookie(n)&&(document.cookie=n+"="+(t?";path="+t:"")+(i?";domain="+i:"")+";expires=Thu, 01 Jan 1970 00:00:01 GMT")}function get_cookie(n){return document.cookie.split(";").some(t=>t.trim().startsWith(n+"="))}var accountValidations={validateContactForm:function(n){let t=!0,i=!0;return $("#frmContactPerson").find("input").each(function(){var n=$(this).hasClass("hide_element");n||(i=$.validateInput(this),t&&!i&&(t=!1))}),t||n.push(n.push(AccountsValidationMessages.completeData)),t},validateContactData:function(n,t,i,r){let f=this,u=[],e=f.validateContactForm(u);return e?(f.checkBusinessValidationsErrorsExsists(n,u),f.validateEmailRelatedToDomain(t.Email,u),i!=foundationType.Security&&f.validateEmailDomainData("Email",t.Email,u,AccountsValidationMessages.EmailNotRelatedToDomain),f.validateDuplicateData("Mobile",t.Mobile,u,AccountsValidationMessages.DuplicateContactMobile,r),f.validateDuplicateData("Email",t.Email,u,AccountsValidationMessages.DuplicateContactEmail,r),f.validateDuplicateData("IdNumber",t.IdNumber,u,AccountsValidationMessages.DuplicateContactIdNumber,r),e=u.length===0,e||alertHelper.dashboard.errorMultiLine(messagesData.Error,u),e):e},validateEmailRelatedToDomain:function(n,t){let r=$("#Domain").val();if($("#Domain").length<5)return!1;let i=StringHelper.validateEmailIsRelatedToDomain(n,r);return i||($.smkAddError($("#Email"),AccountsValidationMessages.EmailNotRelatedToDomain),t&&t.push(AccountsValidationMessages.EmailNotRelatedToDomain)),i},validateHasAccountManager:function(n){let t=!1;return contactPersonsList.forEach(function(n){n.IsAccountManager&&(t=!0)}),t||n&&n.push(AccountsValidationMessages.MustHaveAccountManager),t},validateHasOnlyOneAccountManager:function(n){var r=$("#isBusinesseExternalGate").val();if(r){let t=!1,i=0;return contactPersonsList.forEach(function(n){n.IsAccountManager&&(i=i+1)}),i<=1&&(t=!0),t||n&&n.push(AccountsValidationMessages.MustHaveOnlyOneAccountManager),t}},validateHasContacts:function(n){let t=!0;return contactPersonsList.length==0&&(t=!1,n.push(AccountsValidationMessages.MustAddContactPersons)),t},validateHasAttachments:function(n){let t=!0;return $("#attachementGrid tbody tr").length==0&&(t=!1,n.push(AccountsValidationMessages.MustAddAttachments)),t},checkBusinessValidationsErrorsExsists:function(n,t){let i=!0;return n.find(".has-business-error").each(function(){t.push($(this).attr("data-business-error"));i=!1}),i},validateAccountForm:function(n,t){let i=!0,r=!0;if(n)return n.find("input,select,textarea").not(".runtime-form,.has-business-error").each(function(){$(this).is(":visible")&&(r=$.validateInput(this),i&&!r&&(i=!1))}),i?void 0:(t.push(AccountsValidationMessages.completeOrCoruptedData),i)},validateAccountFormPasswords:function(n,t){return formHelper.validatePasswordAndConfermPassword("AccountPasswordConferm","AccountPassword",t)},validateStep2:function(n){let r=this,t=[],i=!0;return r.validateAccountForm(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validateStep3:function(n){let r=this,t=[],i=!0;return r.validateAccountForm(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validateStep4:function(){let t=this,n=[],i=!0;return t.validateHasContacts(n),t.validateHasAccountManager(n),t.validateHasOnlyOneAccountManager(n),i=n.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,n),i},validateStep5:function(){let i=this,n=[],t=!0;return i.validateHasAttachments(n),t=n.length===0,t||alertHelper.dashboard.errorMultiLine(messagesData.Error,n),t},validateStep6:function(n){let r=this,t=[],i=!0;return r.validateAccountForm(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validate:function(n,t,i,r){let f=this,u=[],e=!0;return f.validateAccountForm(n,u),f.validateUserAccountErrors(t,u),f.validateForm(i,u),f.validateForm(r,u),f.validateHasContacts(u),f.validateHasAttachments(u),f.checkBusinessValidationsErrorsExsists(n,u),f.validateHasAccountManager(u),e=u.length===0,e||alertHelper.dashboard.errorMultiLine(messagesData.Error,u),e},validateBase:function(n,t){let u=this,i=[],r=!0;return u.validateForm(n,i),u.validateForm(t,i),r=i.length===0,r||alertHelper.dashboard.errorMultiLine(messagesData.Error,i),r},validateBussiess:function(n){let i=this,t=[],r=!0;return i.validateAccountForm(n,t),i.validateHasContacts(t),i.validateHasAttachments(t),i.checkBusinessValidationsErrorsExsists(n,t),i.validateHasAccountManager(t),r=t.length===0,r||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),r},validateUserAccount:function(n){let r=this,t=[],i=!0;return r.validateAccountForm(n,t),r.validateAccountFormPasswords(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validateUserAccountErrors:function(n,t){let r=this,i=!0;return r.validateAccountForm(n,t),r.validateAccountFormPasswords(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validateForm:function(n,t){let r=this,i=!0;return r.validateAccountForm(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validateDuplicateData:function(n,t,i,r,u){let f=!0;return contactPersonsList.forEach(function(i,r){r!=u&&t&&i[n]!=null&&i[n].toString()!=null&&i[n].toString().toLowerCase()===t.toLowerCase()&&(f=!1)}),f||($.smkAddError($("#"+n),r),i&&i.push(r)),f},validateEmailDomainData:function(n,t,i,r){let f=$("#DomainData").val().toLowerCase(),u=!0;return t.toLowerCase().indexOf(f)<0&&(u=!1),u||(r=r.replace("##",f),$.smkAddError($("#"+n),r),i&&i.push(r)),u},dateChangeEvent:function(){},registerEvents:function(n){let t=this;$("#frmContactPerson").find("input").change(function(){$.validateInput(this)});$("#frmContactPerson").find("#Email").change(function(){let i=$(this).val(),r=$("#frmContactPerson").attr("data-edit-item-index");t.validateEmailRelatedToDomain(i,n);t.validateDuplicateData("Email",$(this).val(),n,AccountsValidationMessages.DuplicateContactEmail,r)});$("#frmContactPerson").find("#Mobile").change(function(){t.validateDuplicateData("Mobile",$(this).val(),n,AccountsValidationMessages.DuplicateContactMobile)});$("#frmContactPerson").find("#FullName").change(function(){});$("#frmContactPerson").find("#IdNumber").change(function(){t.validateDuplicateData("IdNumber",$(this).val(),n,AccountsValidationMessages.DuplicateContactIdNumber)});$("#frmFoundationAccount").find("#FoundationNo").change(function(){});$("#frmFoundationAccount").find("#NameAr").change(function(){});$("#frmFoundationAccount").find("#NameEn").change(function(){})}},attachmentController={controller:null,init:function(n){this.controller=n},add:function(n){var r,u;let o=this,t=$(n);r=$("#frmAttachment");let i=!0,f=!0,e=!0;if(r.find("input,select,textarea").not(".runtime-form,.has-business-error").each(function(){f=$.validateInput(this);i&&!f&&(i=!1)}),r.find('input[type="file"]').not(".runtime-form,.has-business-error").each(function(){e=validationHelper.validateFile($(this));i&&!e&&(i=!1)}),!i)return!1;t.prop("disabled",!0);t.addClass("btn-loading");let s=`/Security/Upload`;u=new FormData(r[0]);console.info(u);let h=$.ajax({type:"POST",url:s,data:u,cache:!1,processData:!1,contentType:!1,success:function(n){t.prop("disabled",!1);t.removeClass("btn-loading");n.status?n.data?o.appendRow(n.data):alertHelper.dashboard.error(messagesData.Error,messagesData.FailedUploadAttachment):alertHelper.dashboard.errorMultiLine(messagesData.Error,n.ErrorMessages);console.info(n)},error:function(n,i,r){t.prop("disabled",!1);t.removeClass("btn-loading");console.info("Status: "+n);alert("Status: "+i);alert("Error: "+r)}})},reset:function(){$("#AttachedFile").val("");$("#AttachmentTypeId").val("");$("#AttachmentTypeId").change();$.smkRemoveError($("#AttachmentTypeId"))},bindGrid:function(n){let t=this;$("#attachementGrid tbody").empty();n&&n.forEach(n=>{t.appendRow(n)})},bindGridEdit:function(n){let t=this;$("#attachementGrid tbody").empty();n&&n.forEach(n=>{t.appendRowEdit(n)})},appendRow:function(n){var r=$("#languageType").val();let t=n.attachmentTypeAr;r==2&&(t=n.attachmentTypeEn);let u=this,f=$('input[name="FoundationAccountId"]').val(),i=$("#attachementGrid tbody tr").length,e=`<tr data-index="${i}">
             <td><strong>${i+1}</strong><input type="hidden" id="AttachmentId" class="runtime-form" name="AttachmentId" value="${n.attachmentId}"/></td>
            <td><span class="text-primary"><b>${t}</b></span></td>
            <td><span class="text-primary"><b>${n.uploadedFileName}</b></span></td>            
             <td><span class="text-primary"><b>${n.size}</b></span></td>
             <td class="">
                 <div class="d-flex justify-content-end">
                    <a href="/Security/Download?filename=${n.fileName}" target="_blank"  class="btn btn-outline-primary btn-sm py-1 mx-1">${messagesData.Download}</a>
                    &nbsp;
                    <button onclick="actionsController.delete(this,event);" data-title="${n.uploadedFileName}" data-action-url="/Security/DeleteAttachment" data-to-post="{&quot;FoundationAccountId&quot;:&quot;${f}&quot;,&quot;AttachmentId&quot;:&quot;${n.attachmentId}&quot;,&quot;FileName&quot;:&quot;${n.fileName}&quot;}" class="btn btn-outline-danger btn-md py-1">${messagesData.Delete}</button>
                 </div>
             </td>
         </tr>`;$("#attachementGrid tbody").append(e);u.reset()},appendRowEdit:function(n){var r=$("#languageType").val();let t=n.attachmentTypeAr;r==2&&(t=n.attachmentTypeEn);let u=this,f=$('input[name="FoundationAccountId"]').val(),i=$("#attachementGrid tbody tr").length,e=`<tr data-index="${i}">
             <td><strong>${i+1}</strong><input type="hidden" id="AttachmentId" class="runtime-form" name="AttachmentId" value="${n.AttachmentId}"/></td>
            <td><span class="text-primary"><b>${t}</b></span></td>
            <td><span class="text-primary"><b>${n.UploadedFileName}</b></span></td>            
             <td><span class="text-primary"><b>${n.Size}</b></span></td>
             <td class="">
                 <div class="d-flex justify-content-end">
                    <a href="/Security/Download?filename=${n.FileName}" target="_blank"  class="btn btn-outline-primary btn-sm py-1 mx-1">${messagesData.Download}</a>
                    &nbsp;
                    <button onclick="actionsController.delete(this,event);" data-title="${n.UploadedFileName}" data-action-url="/Security/DeleteAttachment" data-to-post="{&quot;FoundationAccountId&quot;:&quot;${f}&quot;,&quot;AttachmentId&quot;:&quot;${n.AttachmentId}&quot;,&quot;FileName&quot;:&quot;${n.FileName}&quot;}" class="btn btn-outline-danger btn-md py-1">${messagesData.Delete}</button>
                 </div>
             </td>
         </tr>`;$("#attachementGrid tbody").append(e);u.reset()}},contactPersonsList=[],contactPersonsController={FoundationTypeId:null,config:{isEditMode:!1,isBusinesseExternalGate:!1,saveURL:"/Security/SaveRegistrationContact",deleteURL:"/Security/DeleteRegistrationContact"},add:function(n){let i=this,r=$(n),u=$("#frmContactPerson"),t=formHelper.objectifyDiv(u),f=accountValidations.validateContactData(u,t,i.FoundationTypeId);if(!f)return!1;if(t.dateType=="1"?(t.BirthDateHijri=t.BirthDateHijri,t.BirthDate=null):(t.BirthDate=t.BirthDate,t.BirthDateHijri=null),r.addClass("btn-loading"),i.config.isEditMode){let n=i.config.saveURL,u=JSON.stringify(t),f=formHelper.postAjax(n,u);f.done(function(n,u,f){if(r.removeClass("btn-loading"),n.status){t.ContactId=n.data.userID;t.FullName=n.data.fullName;console.log("data",t);i.appendRow(t);contactPersonsList.push(t);i.resetForm();let r=messagesData.AccountSavedSuccessfully.replace("{0}",t.FullName);alertHelper.dashboard.success(r,"")}else alertHelper.dashboard.showResponse(n,u,f)})}else console.log("data",t),i.appendRow(t),r.removeClass("btn-loading"),contactPersonsList.push(t),i.resetForm()},loadForEdit:function(n,t){let r=this;r.resetForm();t.preventDefault();let u=$(n).attr("data-index"),i=contactPersonsList[u];i.dateType=i.BirthDate!=null?"2":"1";let f=$("#frmContactPerson");formHelper.bindFormWithJson(f,i);$("#txtFullName").val(i.FullName);$("#dateType").select2("val",i.dateType);i.dateType=="1"?($("#BirthDateHijri").css("display","block"),$("#BirthDate").css("display","none"),$("#BirthDateHijri").removeClass("hide_element"),$("#BirthDate").addClass("hide_element"),$("#BirthDate").val(undefined),$("#BirthDate").removeAttr("required")):($("#BirthDate").css("display","block"),$("#BirthDateHijri").css("display","none"),$("#BirthDateHijri").addClass("hide_element"),$("#BirthDate").removeClass("hide_element"),$("#BirthDateHijri").val(undefined),$("#BirthDateHijri").removeAttr("required"));$("#isBusinesseExternalGateHF").val()!="1"&&($("#IdNumber").prop("disabled",!0),$("#dateType").prop("disabled",!0),$("#BirthDate").prop("disabled",!0),$("#BirthDateHijri").prop("disabled",!0));f.attr("data-edit-item-index",u);r.showEdit()},update:function(n){let i=this,u=$(n),f=$("#frmContactPerson"),r=$("#frmContactPerson").attr("data-edit-item-index"),t=formHelper.objectifyDiv(f),e=accountValidations.validateContactData(f,t,i.FoundationTypeId,r);if(!e)return!1;if(u.addClass("btn-loading"),i.config.isEditMode){if(!t.IsAccountManager){var o=contactPersonsList.filter(n=>n.IsAccountManager).length;if(o<=0){alertHelper.dashboard.error(messagesData.atLeastOneAccountManager,[]);return}}let n=i.config.saveURL,f=JSON.stringify(t),e=formHelper.postAjax(n,f);e.done(function(n,f,e){if(n.status){t.ContactId=n.data.userID;t.IdNumber=$("#IdNumber").val();t.dateType=$("#dateType").val();t.BirthDate=$("#BirthDate").val();t.BirthDateHijri=$("#BirthDateHijri").val();r!==-1&&(contactPersonsList[r]=t);console.log("updated-data",t);i.bindGrid();i.resetForm();u.removeClass("btn-loading");$("#frmContactPerson").attr("data-edit-item-index",null);$("#IdNumber").prop("disabled",!1);$("#dateType").prop("disabled",!1);$("#BirthDate").prop("disabled",!1);$("#BirthDateHijri").prop("disabled",!1);let f=messagesData.AccountSavedSuccessfully.replace("{0}",t.FullName);alertHelper.dashboard.success(f,"")}else u.removeClass("btn-loading"),alertHelper.dashboard.showResponse(n,f,e)})}else t.IdNumber=$("#IdNumber").val(),t.dateType=$("#dateType").val(),t.BirthDate=$("#BirthDate").val(),t.BirthDateHijri=$("#BirthDateHijri").val(),r!==-1&&(contactPersonsList[r]=t),$("#IdNumber").prop("disabled",!1),$("#dateType").prop("disabled",!1),$("#BirthDate").prop("disabled",!1),$("#BirthDateHijri").prop("disabled",!1),console.log("updated-data",t),i.bindGrid(),i.resetForm(),u.removeClass("btn-loading")},resetForm:function(){let n=this;n.showAdd();$("#frmContactPerson").find("textarea,input").not("input[type=radio],input[type=checkbox]").each(function(){$(this).val("");$.smkRemoveError($(this))});$("input[name=IsAccountManager][value=false]").prop("checked",!0).trigger("click")},confirmDelete:function(n,t){let i=this,r=$(n).attr("data-index"),u=contactPersonsList[r];if(u.IsAccountManager){var f=contactPersonsList.filter(n=>n.IsAccountManager).length;if(f<=1){alertHelper.dashboard.error(messagesData.onlyOneAccountManagerDelete,[]);return}}actionsController.runTimeDelete(n,t,function(){i.delete(n)})},"delete":function(n){let t=this;event.preventDefault();let r=$(n).closest("div.card-box"),i=$(n).attr("data-index");if(t.config.isEditMode){let n=contactPersonsList[i],u=t.config.deleteURL+"/"+n.ContactId,f=formHelper.postAjax(u,"");f.done(function(n,u,f){n.status?(contactPersonsList.splice(i,1),console.log("contactPersonsList",contactPersonsList),r.css("background-color","#ffe8e8").hide({duration:700,done:function(){t.bindGrid()}})):alertHelper.dashboard.showResponse(n,u,f)})}else contactPersonsList.splice(i,1),console.log("contactPersonsList",contactPersonsList),r.css("background-color","#ffe8e8").hide({duration:700,done:function(){t.bindGrid()}})},loadContactPersons:function(n){let t=this;t.FoundationTypeId=n.Account.FoundationTypeId;console.log("user",n);contactPersonsList=n&&n.Contacts&&n.Contacts.length>0?n.Contacts:[];t.bindGrid()},showAdd:function(){let n=this;$("#frmContactPerson").find("#send").show();$("#frmContactPerson").find("#update").hide()},showEdit:function(){let n=this;$("#frmContactPerson").find("#send").hide();$("#frmContactPerson").find("#update").show()},appendRow:function(n){var r,f,t;let e=this;$("#myTable");let i=$("#contactsGrid div.card-item-person").length,u=n.IsAccountManager===!0?messagesData.AccountManager:messagesData.Delegate;r="";e.config.isEditMode&&(f=$("#isBusinesseExternalGate").val(),f&&n.IsAccountManager===!0&&(r="d-none"));u=n.IsAccountManager===!0?messagesData.ContactManager:messagesData.ContactData;n.FullName==undefined&&(n.FullName="");t=n.IdNumber;t==undefined&&(t="");t=="0"&&(t="");let o=`
                <div class="col-md-6 col-lg-4 mb-5 card-box card-item-person"   data-index="${i}">
                        <div class="contact_item">
                            <div class="d-flex mb-5 justify-content-between align-items-center">
                                <label class="d-flex align-items-center mb-0">
                                   
                                    <span class=" fw-600">${u}</span>
                                </label>
                                <div>
                                    <a onclick="contactPersonsController.loadForEdit(this,event);" data-index="${i}" class="text-blue mx-1" href="javascript:void(0)">
                                        <i class="mutasil-icon mutasil-user-user15 fs-25"></i>
                                    </a>
                                    <a onclick="contactPersonsController.confirmDelete(this,event);" data-index="${i}" data-title="${n.FullName}" class="text-danger ${r}" href="javascript:void(0)">
                                        <i class="mutasil-icon mutasil-icon-36 fs-25"></i>
                                    </a>
                                </div>
                            </div>

                            <h5 class="mb-2">${n.FullName}</h5>
                            <p class="mb-0">${t}</p>
                            <p class="mb-0">${n.Posission}</p>
                            <hr />
                            <p>
                                <b>${messagesData.Mobile} : </b>
                                ${n.Mobile}
                            </p>
                            <p class="mb-0">
                                <b>${messagesData.Email} : </b>
                                <br />
                               ${n.Email}
                            </p>
                        </div>
                    </div>
            `;$("#contactsGrid").append(o)},bindGrid:function(){let n=this;$("#contactsGrid").empty();contactPersonsList&&contactPersonsList.forEach(t=>{n.appendRow(t)})}},validationHelper={validateBusiness:function(n,t,i,r){$.ajax({url:t,method:"GET",success:function(t){t?(n.removeAttr("data-business-error"),$.smkRemoveError(n),n.removeClass("has-business-error"),$.smkAddError(n,i),n.addClass("has-business-error"),n.attr("data-business-error",i),r?r.push(i):swal.fire(i,"","error")):(n.attr("data-business-error",i),n.removeAttr("data-business-error"),$.smkRemoveError(n),n.removeClass("has-business-error"))},error:function(){}})},addValidateBusiness:function(n,t,i){$.smkAddError(n,t);n.addClass("has-business-error");n.attr("data-business-error",t);i?i.push(t):swal.fire(t,"","error")},removeValidateBusiness:function(n,t){n.attr("data-business-error",t);n.removeAttr("data-business-error");$.smkRemoveError(n);n.removeClass("has-business-error")},validateFile:function(n){var i,r,u;let t=[];if(i=n[0].files,i.length>0){let f=n.attr("data-extensions"),e=parseInt(n.attr("data-maxsize")),o=n.attr("data-maxsize-error"),s=n.attr("data-extensions-error");const h=f.split(",");for(r=0,u=i.length;r<u;r++){let n=i[r].name.split(".").pop().toLowerCase();$.inArray(n,h)==-1&&t.push(s);i[r].size>e&&t.push(o);i[r].size==0&&t.push(messages.emptyFile)}$.smkRemoveError(n);t.length>0&&t.forEach(function(t){$.smkAddError(n,t)})}return t.length===0},validateFiles:function(){$("input:file").change(function(){validationHelper.validateFile($(this))})}},foundationAccountController={config:{isEditMode:!1,editURL:"/Security/EditRegistration"},isSubmitBussiness:!1,isSubmitGovernment:!1,foundation:null,controller:null,validator:accountValidations,contactsCtrl:contactPersonsController,attachCtrl:attachmentController,addTestData:function(){let n={CrCountryID:2,FoundationNo:"78888888888",NameAr:messagesData.CompanyWithArabicName,NameEn:"EnglishName",FoundationField:"نشاط الشركة",CountryID:2,City:"المدينة",Address:"العنوان",Tel:"0561232323",Website:"http://www.google.com",Domain:"google.com",ZipCode:"11111",PostalCode:"2222",WaselNo:"12345"};jsonHelper.bindJsonToForm(n,$("#frmFoundationAccount"));jsonHelper.bindJsonToForm({IdNumber:"1234567890",BirthDate:"10-10-2020",BirthDateHijri:"1443-06-15",FullName:"الاسم بالكامل",Posission:"المنصب",Mobile:"0567121212",Email:"test@google.com",Tel:"0567121212"},$("#frmContactPerson"));$("#CrCountryID").change();$("#CountryID").change()},init:function(n){this.controller=n},prepareForm:function(n){let r=this,t=$("#frmContactPerson"),i=$("#frmFoundationAccount"),u=$("#frmFoundationAddress");t.find("#BirthDate").css("display","block");t.find("#BirthDateHijri").css("display","none");t.find("#BirthDateHijri").addClass("hide_element");t.find("#BirthDateHijri").removeAttr("required");$("#dateType").change(function(){let n=$(this).val();n.startsWith("1")?(t.find("#BirthDateHijri").css("display","block"),t.find("#BirthDate").css("display","none"),t.find("#BirthDateHijri").removeClass("hide_element"),t.find("#BirthDate").addClass("hide_element"),t.find("#BirthDate").val(undefined)):(t.find("#BirthDate").css("display","block"),t.find("#BirthDateHijri").css("display","none"),t.find("#BirthDateHijri").addClass("hide_element"),t.find("#BirthDate").removeClass("hide_element"),t.find("#BirthDateHijri").val(undefined))});switch(n.Account.FoundationTypeId){case foundationType.BusinessInternal:$("#lblViewTitle").text(messagesData.InternalFoundationManage);$("#lblViewText").text(messagesData.InternalFoundationAddAccount);$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","idnumber");$("#Mobile").attr("type","mobile");break;case foundationType.ServiceProvider:$("#lblViewTitle").text(messagesData.ServiceProviderManage);$("#lblViewText").text(messagesData.ServiceProviderAddAccount);$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","idnumber");$("#Mobile").attr("type","mobile");break;case foundationType.BusinessExternal:$("#lblViewTitle").text(messagesData.ExternalAccountManage);$("#lblViewText").text(messagesData.ExternalAddAccount);i.find("#divFoundationField").css("display","block");i.find("#divCrCountryID").css("display","block");i.find("#divCountryID").css("display","block");i.find("#addressCountry").css("display","block");i.find("#foundationWebsite").css("display","block");$("#NameAr").attr("type","text");$("#NameEn").attr("type","text");$("#NameAr").attr("data-smk-type","text");$("#NameEn").attr("data-smk-type","text");$("#IdNumber").attr("maxlength","15");$("#IdNumber").attr("minlength","5");break;case foundationType.Government:$("#lblViewTitle").text(messagesData.GovernmentManageAccount);$("#lblViewText").text(messagesData.AddGovernmentAccount);$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","nationalid");$("#Mobile").attr("type","mobile");break;case foundationType.Security:$("#lblViewTitle").text(messagesData.SecurityManageAccount);$("#lblViewText").text(messagesData.SecurityAddManageAccount);$("#FoundationNo").attr("type","foundationnumber");$("#Mobile").attr("type","mobile")}$("#CrCountryID").change(function(){let n=$(this).val();$("#CountryID").val(n);$("#CountryID").trigger("change")});$("#Website").change(function(){let n=$(this).val(),t=StringHelper.getDomainFromUrl(n);$("#Domain").val(t)});accountValidations.registerEvents()},loadData:function(n){let t=this;t.foundation=n;jsonHelper.bindJsonToForm(n.Account,$("#frmFoundationAccount"));jsonHelper.bindJsonToForm(n.Account,$("#frmFoundationAddress"));jsonHelper.bindJsonToForm(n.Account,$("#frmFoundationComments"));jsonHelper.bindJsonToForm(n.UserLogin,$("#frmFoundationUserAccount"));$("#AccountEmailRep").val($("#AccountEmail").val());contactPersonsController.loadContactPersons(n);attachmentController.bindGridEdit(n.Attachments);t.prepareForm(n)},nextStep2:function(){let n=this,t=$("#frmFoundationAccount"),i=n.validator.validateStep2(t);return i?!0:(event.preventDefault(),!1)},nextStep3:function(){let n=this,t=$("#frmFoundationAddress"),i=n.validator.validateStep3(t);return i?!0:(event.preventDefault(),!1)},nextStep4:function(){let n=this,t=n.validator.validateStep4();return t?!0:(event.preventDefault(),!1)},nextStep5:function(){let n=this,t=n.validator.validateStep5();return t?!0:(event.preventDefault(),!1)},nextStep6:function(){let n=this,t=$("#frmFoundationComments"),i=n.validator.validateStep6(t);return i?!0:(event.preventDefault(),!1)},submit:function(n,t){let r=this;if(!r.isSubmitGovernment){t.preventDefault();let f=$(n),e=$("#frmFoundationAccount"),h=$("#frmFoundationUserAccount"),o=$("#frmFoundationAddress"),s=$("#frmFoundationComments"),c=r.validator.validate(e,h,o,s);if(!c)return!1;f.prop("disabled",!0);r.isSubmitGovernment=!0;let l=e.find(":input").not(".runtime-form").serializeAll(),i=formHelper.objectifyArray(l),a=o.find(":input").not(".runtime-form").serializeAll(),u=formHelper.objectifyArray(a);i.Domain=u.Domain;i.CountryId=u.CountryId;i.City=u.City;i.Tel=u.Tel;i.Website=u.Website;i.Address=u.Address;i.ZipCode=u.ZipCode;i.PostalCode=u.PostalCode;let v=s.find(":input").not(".runtime-form").serializeAll(),y=formHelper.objectifyArray(v);if(i.Comment=y.Comment,r.config.isEditMode){let n=r.config.editURL,t=JSON.stringify(i),u=formHelper.postAjax(n,t);u.done(function(n,t,i){r.isSubmitGovernment=!1;f.prop("disabled",!1);n.status?alertHelper.dashboard.success(AccountsValidationMessages.FoundationAccountSavesSuccess,""):n.errorMessages.length<=0?alertHelper.dashboard.error(AccountsValidationMessages.FoundationAccountSavesNoChangeData,""):alertHelper.dashboard.showResponse(n,t,i)})}else{let n=e.attr("action");console.log("json",i);i.FoundationContacts=contactPersonsList;let t=JSON.stringify(i),u=formHelper.postAjax(n,t);u.done(function(n,t,i){r.isSubmitGovernment=!1;f.prop("disabled",!1);n.status?(r.reset(),window.location="/Security/RegistrationCompleted"):alertHelper.dashboard.showResponse(n,t,i)})}}},submitAddress:function(n,t){let u=this;t.preventDefault();let f=$(n),e=$("#frmFoundationAccount"),y=$("#frmFoundationUserAccount"),o=$("#frmFoundationAddress"),s=$("#frmFoundationComments"),h=u.validator.validateBase(o,s);if(!h)return!1;f.prop("disabled",!0);let c=e.find(":input").not(".runtime-form").serializeAll(),i=formHelper.objectifyArray(c),l=o.find(":input").not(".runtime-form").serializeAll(),r=formHelper.objectifyArray(l);i.Domain=r.Domain;i.CountryId=r.CountryId;i.City=r.City;i.Tel=r.Tel;i.Website=r.Website;i.Address=r.Address;i.ZipCode=r.ZipCode;i.PostalCode=r.PostalCode;let a=s.find(":input").not(".runtime-form").serializeAll(),v=formHelper.objectifyArray(a);if(i.Comment=v.Comment,u.config.isEditMode){let n=u.config.editURL,t=JSON.stringify(i),r=formHelper.postAjax(n,t);r.done(function(n,t,i){f.prop("disabled",!1);n.status?alertHelper.dashboard.success(AccountsValidationMessages.FoundationAccountSavesSuccess,""):n.errorMessages.length<=0?alertHelper.dashboard.error(AccountsValidationMessages.FoundationAccountSavesNoChangeData,""):alertHelper.dashboard.showResponse(n,t,i)})}else{let n=e.attr("action");console.log("json",i);i.FoundationContacts=contactPersonsList;let t=JSON.stringify(i),r=formHelper.postAjax(n,t);r.done(function(n,t,i){f.prop("disabled",!1);n.status?(u.reset(),window.location="/Security/RegistrationCompleted"):alertHelper.dashboard.showResponse(n,t,i)})}},submitBussiness:function(n,t){let i=this;i.config.isEditMode?i.submitBussinessEdit(n,t):i.submitBussinessCreate(n,t)},submitBussinessCreate:function(n,t){let u=this;if(!u.isSubmitBussiness){t.preventDefault();let e=$(n),f=$("#frmFoundationAccount"),o=$("#frmFoundationUserAccount"),s=$("#frmFoundationAddress"),h=$("#frmFoundationComments"),c=u.validator.validate(f,o,s,h);if(!c)return!1;e.prop("disabled","disabled");u.isSubmitBussiness=!0;let l=f.find(":input").not(".runtime-form").serializeAll(),i=formHelper.objectifyArray(l),a=o.find(":input").not(".runtime-form").serializeAll();i.UserLogin=formHelper.objectifyArray(a);let v=s.find(":input").not(".runtime-form").serializeAll(),r=formHelper.objectifyArray(v);i.Domain=r.Domain;i.CountryId=r.CountryId;i.City=r.City;i.Tel=r.Tel;i.Website=r.Website;i.Address=r.Address;i.ZipCode=r.ZipCode;i.PostalCode=r.PostalCode;let y=h.find(":input").not(".runtime-form").serializeAll(),p=formHelper.objectifyArray(y);i.Comment=p.Comment;let w=f.attr("action");console.log("json",i);i.FoundationContacts=contactPersonsList;let b=JSON.stringify(i),k=formHelper.postAjax(w,b);k.done(function(n,t,i){e.prop("disabled",!1);u.isSubmitBussiness=!1;n.status?(u.reset(),window.location="/Security/RegistrationCompleted"):alertHelper.dashboard.showResponse(n,t,i)})}},reset:function(){let n=this;var t=globals.createGuid();$("textarea,input").not("#FoundationTypeId").val("");$('input[name="FoundationAccountId"]').val(t);contactPersonsList=[];n.contactsCtrl.showAdd();n.contactsCtrl.bindGrid();n.attachCtrl.bindGrid([])}},delegationsValidations={validateUniqueIdNumber:function(){let t=$("#IdNumber"),n=t.val();if(n.length!=0){var i=`/Security/IsIdNumberExists?idNumber=${n}`;validationHelper.validateBusiness($foundationNo,i,AccountsValidationMessages.NotUniqueIsIdNumber)}},validateContactForm:function(n){let t=!0,i=!0;return $("#frmDelegations").find("input").each(function(){var n=$(this).hasClass("hide_element");n||(i=$.validateInput(this),t&&!i&&(t=!1))}),t||n.push(n.push(AccountsValidationMessages.completeData)),t},validateContactData:function(n,t){let r=this,i=[],u=r.validateContactForm(i),f=r.validateSelectServices("Services",i,AccountsValidationMessages.ServiceSelections);return!u||!f?!1:(r.checkBusinessValidationsErrorsExsists(n,i),r.validateEmailRelatedToDomain(t.Email,i),r.validateSelectServices("Services",i,AccountsValidationMessages.ServiceSelections),r.validateDuplicateData("Mobile",t.Mobile,i,AccountsValidationMessages.DuplicateContactMobile,delegatUsersList),r.validateDuplicateData("Email",t.Email,i,AccountsValidationMessages.DuplicateContactEmail,delegatUsersList),r.validateDuplicateData("IdNumber",t.IdNumber,i,AccountsValidationMessages.DuplicateContactIdNumber,delegatUsersList),u=i.length===0,u||alertHelper.dashboard.errorMultiLine(messagesData.Error,i),u)},validateContactDataUpdate:function(n,t){let r=this,i=[],u=r.validateContactForm(i),e=r.validateSelectServices("Services",i,AccountsValidationMessages.ServiceSelections);if(!u||!e)return!1;r.checkBusinessValidationsErrorsExsists(n,i);r.validateEmailRelatedToDomain(t.Email,i);r.validateSelectServices("Services",i,AccountsValidationMessages.ServiceSelections);let f=delegatUsersList.filter(n=>n.UserID!=t.UserID);return r.validateDuplicateData("Mobile",t.Mobile,i,AccountsValidationMessages.DuplicateContactMobile,f),r.validateDuplicateData("Email",t.Email,i,AccountsValidationMessages.DuplicateContactEmail,f),r.validateDuplicateData("IdNumber",t.IdNumber,i,AccountsValidationMessages.DuplicateContactIdNumber,f),u=i.length===0,u||alertHelper.dashboard.errorMultiLine(messagesData.Error,i),u},validateEmailRelatedToDomain:function(n,t){let r=$("#Domain").val();if($("#Domain").length<5)return!1;let i=StringHelper.validateEmailIsRelatedToDomain(n,r);return i||($.smkAddError($("#Email"),AccountsValidationMessages.EmailNotRelatedToDomain),t&&t.push(AccountsValidationMessages.EmailNotRelatedToDomain)),i},validateHasContacts:function(n){let t=!0;return delegatUsersList.length==0&&(t=!1,n.push(AccountsValidationMessages.MustAddContactPersons)),t},validateHasAttachments:function(n){let t=!0;return $("#attachementGrid tbody tr").length==0&&(t=!1,n.push(AccountsValidationMessages.MustAddAttachments)),t},checkBusinessValidationsErrorsExsists:function(n,t){let i=!0;return n.find(".has-business-error").each(function(){t.push($(this).attr("data-business-error"));i=!1}),i},validateAccountForm:function(n,t){let i=!0,r=!0;return n.find("input,select,textarea").not(".runtime-form,.has-business-error").each(function(){$(this).is(":visible")&&(r=$.validateInput(this),i&&!r&&(i=!1))}),i?void 0:(t.push(AccountsValidationMessages.completeData),i)},validate:function(n){let i=this,t=[],r=!0;return i.validateAccountForm(n,t),i.validateHasContacts(t),i.validateHasAttachments(t),i.checkBusinessValidationsErrorsExsists(n,t),i.validateDuplicateData("Mobile",data.Mobile,t,AccountsValidationMessages.DuplicateContactMobile),i.validateDuplicateData("Email",data.Email,t,AccountsValidationMessages.DuplicateContactEmail),i.validateDuplicateData("IdNumber",data.IdNumber,t,AccountsValidationMessages.DuplicateContactIdNumber),i.validateSelectServices("Services",t,AccountsValidationMessages.ServiceSelections),r=t.length===0,r||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),r},validateUserAccount:function(n){let r=this,t=[],i=!0;return r.validateAccountForm(n,t),i=t.length===0,i||alertHelper.dashboard.errorMultiLine(messagesData.Error,t),i},validateDuplicateData:function(n,t,i,r,u){let f=!0;return u.forEach(function(i){t&&i[n]!=null&&i[n].toString()!=null&&i[n].toString().toLowerCase()===t.toLowerCase()&&(f=!1)}),f||($.smkAddError($("#"+n),r),i&&i.push(r)),f},validateSelectServices:function(n,t,i){let r=!0,u=$("#"+n).multipleSelect("getSelects");return u==""&&(r=!1),r||($.smkAddError($("#"+n),i),t&&t.push(i)),r},dateChangeEvent:function(){},registerEvents:function(n){let t=this;$("#frmDelegations").find("input").change(function(){$.validateInput(this)});$("#frmDelegations").find("#Email").change(function(){let i=$(this).val();t.validateEmailRelatedToDomain(i,n);t.validateDuplicateData("Email",$(this).val(),n,AccountsValidationMessages.DuplicateContactEmail,delegatUsersList)});$("#frmDelegations").find("#Mobile").change(function(){let i=t.validateDuplicateData("Mobile",$(this).val(),n,AccountsValidationMessages.DuplicateContactMobile,delegatUsersList)});$("#frmDelegations").find("#FullName").change(function(){});$("#frmDelegations").find("#IdNumber").change(function(){t.validateDuplicateData("IdNumber",$(this).val(),n,AccountsValidationMessages.DuplicateContactIdNumber,delegatUsersList)})}},delegatUsersList=[],originalDelegatUsersList=[],delegatUsersController={config:{saveURL:"/Security/SaveDelegate",deleteURL:"/Security/DeleteDelegate",isActionDisabled:!1,isSearchedBefore:!1,pageSize:9,pageIndex:0},add:function(n){let i=this;if(!i.config.isActionDisabled){let r=$(n),u=$("#frmDelegations"),t=formHelper.objectifyDiv(u),f=delegationsValidations.validateContactData(u,t);if(!f)return!1;t.Services=$("#Services").multipleSelect("getSelects");r.prop("disabled",!0);t.dateType=="1"?(t.BirthDateHijri=t.BirthDateHijri,t.BirthDate=null):(t.BirthDate=t.BirthDate,t.BirthDateHijri=null);let e=i.config.saveURL,o=JSON.stringify(t),s=formHelper.postAjax(e,o);i.config.isActionDisabled=!0;s.done(function(n,u,f){if(i.config.isActionDisabled=!1,r.prop("disabled",!1),n.status){t.UserID=n.data.userID;t.FullName=n.data.fullName;i.searchListAdd(t);delegatUsersList.splice(0,0,t);i.rebuildGrid();i.resetForm();i.showNumber();let r=messagesData.DelegateAccountSavedSuccessfully.replace("{0}",t.FullName);alertHelper.dashboard.success(r,"")}else alertHelper.dashboard.showResponse(n,u,f)})}},loadForEdit:function(n,t){let f=this;t.preventDefault();let r=$(n).attr("data-index"),i=delegatUsersList[r];i.BirthDate==""&&(i.BirthDate=null);i.BirthDateHijri==""&&(i.BirthDateHijri=null);i.dateType=null;i.dateType=i.BirthDate!=null?"2":"1";let u=$("#frmDelegations");formHelper.bindFormWithJson(u,i);$("#txtFullName").val(i.FullName);$("#dateType").select2("val",i.dateType);$("#BirthDate").val(i.BirthDate);$("#BirthDateHijri").val(i.BirthDateHijri);$("#IdNumber").prop("disabled",!0);$("#dateType").prop("disabled",!0);$("#BirthDate").prop("disabled",!0);$("#BirthDateHijri").prop("disabled",!0);$("#Services").multipleSelect("setSelects",i.Services);u.attr("data-edit-item-index",r);f.showEdit();document.getElementById("delegatepageTitle").scrollIntoView()},update:function(n,t){t.preventDefault();let r=this;if(!r.config.isActionDisabled){let u=$(n),f=$("#frmDelegations"),i=formHelper.objectifyDiv(f),e=delegationsValidations.validateContactDataUpdate(f,i);if(!e)return!1;u.prop("disabled",!0);i.Services=$("#Services").multipleSelect("getSelects");i.dateType=="1"?(i.BirthDateHijri=i.BirthDateHijri,i.BirthDate=null):(i.BirthDate=i.BirthDate,i.BirthDateHijri=null);i.IdNumber=$("#IdNumber").val();i.dateType=$("#dateType").val();i.BirthDate=$("#BirthDate").val();i.BirthDateHijri=$("#BirthDateHijri").val();let o=r.config.saveURL,s=JSON.stringify(i),h=formHelper.postAjax(o,s);r.config.isActionDisabled=!0;h.done(function(n,t,f){if(r.config.isActionDisabled=!1,u.prop("disabled",!1),n.status){i.IdNumber=$("#IdNumber").val();i.dateType=$("#dateType").val();i.BirthDate=$("#BirthDate").val();i.BirthDateHijri=$("#BirthDateHijri").val();i.UserID=n.data.userID;let t=$("#frmDelegations").attr("data-edit-item-index");t!==-1&&(delegatUsersList[t]=i,r.searchListUpdate(i));console.log("updated-data",i);r.rebuildGrid();r.resetForm();let u=messagesData.DelegateAccountSavedSuccessfully.replace("{0}",i.FullName);alertHelper.dashboard.success(u,"");$("#IdNumber").prop("disabled",!1);$("#dateType").prop("disabled",!1);$("#BirthDate").prop("disabled",!1);$("#BirthDateHijri").prop("disabled",!1)}else alertHelper.dashboard.showResponse(n,t,f)})}},resetForm:function(){let n=this;n.showAdd();n.showNumber();$("#frmDelegations").find("textarea,input").not("input[type=radio],input[type=checkbox]").each(function(){$(this).val("");$.smkRemoveError($(this))});try{$("#Services").multipleSelect("setSelects",[])}catch(t){}$("input[name=IsAccountManager][value=false]").prop("checked",!0).trigger("click")},confirmDelete:function(n,t){let i=this;actionsController.runTimeDelete(n,t,function(){i.delete(n)})},"delete":function(n){let t=this;event.preventDefault();let i=$(n).attr("data-index"),u=$(n).closest("div.card-item-person"),r=delegatUsersList[i],f=t.config.deleteURL+"/"+r.UserID,e=formHelper.postAjax(f,"");e.done(function(n,f,e){n.status?(delegatUsersList.splice(i,1),t.searchListDelete(r),console.log("delegatUsersList",delegatUsersList),u.css("background-color","#ffe8e8").hide({duration:700,done:function(){t.rebuildGrid()}}),t.showNumber()):alertHelper.dashboard.showResponse(n,f,e)})},loadContactPersons:function(n){let t=this;console.log("user",n);delegatUsersList=n&&n.length>0?n:[];t.bindGrid()},showAdd:function(){let n=this;$("#frmDelegations").find("#send").show();$("#frmDelegations").find("#update").hide()},showEdit:function(){let n=this;$("#frmDelegations").find("#send").hide();$("#frmDelegations").find("#update").show()},showNumber:function(){$("#usersCounts").html("0");delegatUsersList&&$("#usersCounts").html(delegatUsersList.length)},appendRow:function(n,t){let i=t,r=n.Services.length,u=`<div class="col-md-6 col-lg-4 mb-5 card-item-person"  data-index="${i}">
													<div class="contact_item">
														<div class="d-flex mb-5 justify-content-between align-items-center">
															<div>
																<h5 class="mb-2">${n.FullName}</h5>
																<p class="mb-0">${messagesData.IDNumber} : ${n.IdNumber}</p>
															</div>
															<div class="d-flex">
																
																<a onclick="delegatUsersController.confirmDelete(this,event);" data-index="${i}" data-title="${n.FullName}" class="text-danger" href="javascript:void(0)">
																	<i class="mutasil-icon mutasil-icon-36 fs-20"></i>
																</a>

                                                                <a onclick="delegatUsersController.loadForEdit(this,event);" data-index="${i}"  class="text-blue mx-1" href="javascript:void(0)">
																	<i class="mutasil-icon mutasil-user-user15 fs-20"></i>
																</a>
															</div>
														</div>

														<hr/>
														<p>
															<b>${messagesData.DelegatedServices} : </b>
														</p>
														<div class="tags">
															<span class="tag tag-icon align-items-center">
																<i class="fas fa-check-circle text-blue fa-lg me-2"></i>
															${messagesData.DelegatedFor}	
																<strong class="text-blue mx-1">${r} </strong>
															${messagesData.Service}
															</span>
														</div>
													</div>
												</div>`;$("#contactsGrid").append(u)},paginate:function(n){let t=this;t.config.pageIndex=n;t.rebuildGrid()},rebuildGrid:function(){let n=this,u=delegatUsersList.length,i=n.config.pageSize,t=n.config.pageIndex,r=Math.floor(u/i);u%i>0&&(r=r+1);t<0&&(t=0,n.config.pageIndex=0);t>=r&&(t=r-1,n.config.pageIndex=t);let f=t*i,e=f+i;$("#contactsGrid").empty();delegatUsersList&&delegatUsersList.forEach((t,i)=>{f<=i&&i<e&&n.appendRow(t,i)});n.buildPagger()},buildPagger:function(){let e=this,u=delegatUsersList.length,o=e.config.pageSize,i=e.config.pageIndex,n=Math.floor(u/o);if(u%o>0&&(n=n+1),$("#contactsPager").empty(),!(u<=0)){let f=0,r=n;n>5&&(i>=4?(f=i-3,r=i+1):(f=0,r=4),r>n&&(r=n));let s="",h="";i==0&&(h="disabled");s=`<li class="page-item ${h}">
                    <a class="page-link" href="javascript:void(0)" tabindex="-1" onclick="delegatUsersController.paginate(0)">
                        <i class="fa fa-angle-left"></i>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>`;$("#contactsPager").append(s);for(var t=0;t<n;t++)if(f<=t&&t<=r){let n="";t==i&&(n="active");let r=`<li class="page-item ${n}"><a class="page-link" href="javascript:void(0)" onclick="delegatUsersController.paginate(${t})">${t+1}</a></li>`;$("#contactsPager").append(r)}if(n>5){let t="",r="";n-1==i&&(r="disabled");t=`<li class="page-item ${r}">
                    <a class="page-link" href="javascript:void(0)" tabindex="-1" onclick="delegatUsersController.paginate(${n-1})">
                        <i class="fa fa-angle-right"></i>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>`;$("#contactsPager").append(t)}}},dynamicSort:function(n){var t=1;return n[0]==="-"&&(t=-1,n=n.substr(1)),function(i,r){var u=i[n]<r[n]?-1:i[n]>r[n]?1:0;return u*t}},search:function(n){let i=this;i.config.isSearchedBefore||(originalDelegatUsersList=[],originalDelegatUsersList=originalDelegatUsersList.concat(delegatUsersList),i.config.isSearchedBefore=!0);var t=$(n).val();t&&t.length>0?delegatUsersList=originalDelegatUsersList.filter(function(n){return String(n.FullName).toLowerCase().indexOf(t)>=0||String(n.Mobile).toLowerCase().indexOf(t)>=0||String(n.Email).toLowerCase().indexOf(t)>=0||String(n.IdNumber).toLowerCase().indexOf(t)>=0||String(n.EnglishName).toLowerCase().indexOf(t)>=0}):(delegatUsersList=[],delegatUsersList=originalDelegatUsersList.concat(delegatUsersList),originalDelegatUsersList=[],i.config.isSearchedBefore=!1);delegatUsersList.sort(i.dynamicSort("FullName"));i.config.pageIndex=0;i.rebuildGrid()},resetSearch:function(){ctrl.config.isSearchedBefore=!1;var n=$("#delegateSearchText").val();n&&n.length>0&&(delegatUsersList=[],delegatUsersList=originalDelegatUsersList.concat(delegatUsersList),originalDelegatUsersList=[])},searchListAdd:function(n){originalDelegatUsersList.splice(0,0,n)},searchListUpdate:function(n){const t=originalDelegatUsersList.map(n=>n.UserID).indexOf(n.UserID);t>=0&&(originalDelegatUsersList[t]=n)},searchListDelete:function(n){const t=originalDelegatUsersList.map(n=>n.UserID).indexOf(n.UserID);t>=0&&originalDelegatUsersList.splice(t,1)},bindGrid:function(){let n=this;$("#contactsGrid").empty();n.showNumber();delegatUsersList.sort(n.dynamicSort("FullName"));n.config.pageIndex=0;n.rebuildGrid();n.resetForm()}},delegatSecUsersList=[],originalDelegatSecUsersList=[],delegatUsersSecurityController={config:{saveURL:"/Security/SaveDelegateSecurity",deleteURL:"/Security/DeleteDelegate",isActionDisabled:!1,isSearchedBefore:!1,pageSize:9,pageIndex:0},add:function(n){let i=this;if(!i.config.isActionDisabled){let r=$(n),u=$("#frmDelegations"),t=formHelper.objectifyDiv(u),f=delegationsValidations.validateContactData(u,t);if(!f)return!1;t.Services=$("#Services").multipleSelect("getSelects");r.prop("disabled",!0);t.dateType=="1"?(t.BirthDateHijri=t.BirthDateHijri,t.BirthDate=null):(t.BirthDate=t.BirthDate,t.BirthDateHijri=null);let e=i.config.saveURL,o=JSON.stringify(t),s=formHelper.postAjax(e,o);i.config.isActionDisabled=!0;s.done(function(n,u,f){if(i.config.isActionDisabled=!1,r.prop("disabled",!1),n.status){t.UserID=n.data.userID;t.FullName=n.data.fullName;i.searchListAdd(t);delegatSecUsersList.splice(0,0,t);i.rebuildGrid();i.resetForm();i.showNumber();let r=messagesData.DelegateAccountSavedSuccessfully.replace("{0}",t.FullName);alertHelper.dashboard.success(r,"")}else alertHelper.dashboard.showResponse(n,u,f)})}},loadForEdit:function(n,t){let f=this;t.preventDefault();let r=$(n).attr("data-index"),i=delegatSecUsersList[r];i.BirthDate==""&&(i.BirthDate=null);i.BirthDateHijri==""&&(i.BirthDateHijri=null);i.dateType=null;i.dateType=i.BirthDate!=null?"2":"1";let u=$("#frmDelegations");formHelper.bindFormWithJson(u,i);$("#txtFullName").val(i.FullName);$("#dateType").select2("val",i.dateType);$("#BirthDate").val(i.BirthDate);$("#BirthDateHijri").val(i.BirthDateHijri);$("#IdNumber").prop("disabled",!0);$("#dateType").prop("disabled",!0);$("#BirthDate").prop("disabled",!0);$("#BirthDateHijri").prop("disabled",!0);$("#Services").multipleSelect("setSelects",i.Services);u.attr("data-edit-item-index",r);f.showEdit();document.getElementById("delegatepageTitle").scrollIntoView()},update:function(n,t){t.preventDefault();let r=this;if(!r.config.isActionDisabled){let u=$(n),f=$("#frmDelegations"),i=formHelper.objectifyDiv(f),e=delegationsValidations.validateContactDataUpdate(f,i);if(!e)return!1;u.prop("disabled",!0);i.Services=$("#Services").multipleSelect("getSelects");i.dateType=="1"?(i.BirthDateHijri=i.BirthDateHijri,i.BirthDate=null):(i.BirthDate=i.BirthDate,i.BirthDateHijri=null);i.IdNumber=$("#IdNumber").val();i.dateType=$("#dateType").val();i.BirthDate=$("#BirthDate").val();i.BirthDateHijri=$("#BirthDateHijri").val();let o=r.config.saveURL,s=JSON.stringify(i),h=formHelper.postAjax(o,s);r.config.isActionDisabled=!0;h.done(function(n,t,f){if(r.config.isActionDisabled=!1,u.prop("disabled",!1),n.status){i.IdNumber=$("#IdNumber").val();i.dateType=$("#dateType").val();i.BirthDate=$("#BirthDate").val();i.BirthDateHijri=$("#BirthDateHijri").val();i.UserID=n.data.userID;let t=$("#frmDelegations").attr("data-edit-item-index");t!==-1&&(delegatSecUsersList[t]=i,r.searchListUpdate(i));console.log("updated-data",i);r.rebuildGrid();r.resetForm();let u=messagesData.DelegateAccountSavedSuccessfully.replace("{0}",i.FullName);alertHelper.dashboard.success(u,"");$("#IdNumber").prop("disabled",!1);$("#dateType").prop("disabled",!1);$("#BirthDate").prop("disabled",!1);$("#BirthDateHijri").prop("disabled",!1)}else alertHelper.dashboard.showResponse(n,t,f)})}},resetForm:function(){let n=this;n.showAdd();n.showNumber();$("#frmDelegations").find("textarea,input").not("input[type=radio],input[type=checkbox]").each(function(){$(this).val("");$.smkRemoveError($(this))});try{$("#Services").multipleSelect("setSelects",[])}catch(t){}$("input[name=IsAccountManager][value=false]").prop("checked",!0).trigger("click")},confirmDelete:function(n,t){let i=this;actionsController.runTimeDelete(n,t,function(){i.delete(n)})},"delete":function(n){let t=this;event.preventDefault();let i=$(n).attr("data-index"),u=$(n).closest("div.card-item-person"),r=delegatSecUsersList[i],f=t.config.deleteURL+"/"+r.UserID,e=formHelper.postAjax(f,"");e.done(function(n,f,e){n.status?(delegatSecUsersList.splice(i,1),t.searchListDelete(r),console.log("delegatSecUsersList",delegatSecUsersList),u.css("background-color","#ffe8e8").hide({duration:700,done:function(){t.rebuildGrid()}}),t.showNumber()):alertHelper.dashboard.showResponse(n,f,e)})},loadContactPersons:function(n){let t=this;console.log("user",n);delegatSecUsersList=n&&n.length>0?n:[];t.bindGrid()},showAdd:function(){let n=this;$("#frmDelegations").find("#send").show();$("#frmDelegations").find("#update").hide()},showEdit:function(){let n=this;$("#frmDelegations").find("#send").hide();$("#frmDelegations").find("#update").show()},showNumber:function(){$("#usersCounts").html("0");delegatSecUsersList&&$("#usersCounts").html(delegatSecUsersList.length)},appendRow:function(n,t){let i=t,r=n.Services.length,u=`<div class="col-md-6 col-lg-4 mb-5 card-item-person"  data-index="${i}">
													<div class="contact_item">
														<div class="d-flex mb-5 justify-content-between align-items-center">
															<div>
																<h5 class="mb-2">${n.FullName}</h5>
															</div>
															<div class="d-flex">
																
																<a onclick="delegatUsersSecurityController.confirmDelete(this,event);" data-index="${i}" data-title="${n.FullName}" class="text-danger" href="javascript:void(0)">
																	<i class="mutasil-icon mutasil-icon-36 fs-20"></i>
																</a>

															</div>
														</div>

														<hr/>
														<p>
															<b>${messagesData.DelegatedServices} : </b>
														</p>
														<div class="tags">
															<span class="tag tag-icon align-items-center">
																<i class="fas fa-check-circle text-blue fa-lg me-2"></i>
															${messagesData.DelegatedFor}	
																<strong class="text-blue mx-1">${r} </strong>
															${messagesData.Service}
															</span>
														</div>
													</div>
												</div>`;$("#contactsGrid").append(u)},paginate:function(n){let t=this;t.config.pageIndex=n;t.rebuildGrid()},rebuildGrid:function(){let n=this,u=delegatSecUsersList.length,i=n.config.pageSize,t=n.config.pageIndex,r=Math.floor(u/i);u%i>0&&(r=r+1);t<0&&(t=0,n.config.pageIndex=0);t>=r&&(t=r-1,n.config.pageIndex=t);let f=t*i,e=f+i;$("#contactsGrid").empty();delegatSecUsersList&&delegatSecUsersList.forEach((t,i)=>{f<=i&&i<e&&n.appendRow(t,i)});n.buildPagger()},buildPagger:function(){let e=this,u=delegatSecUsersList.length,o=e.config.pageSize,i=e.config.pageIndex,n=Math.floor(u/o);if(u%o>0&&(n=n+1),$("#contactsPager").empty(),!(u<=0)){let f=0,r=n;n>5&&(i>=4?(f=i-3,r=i+1):(f=0,r=4),r>n&&(r=n));let s="",h="";i==0&&(h="disabled");s=`<li class="page-item ${h}">
                    <a class="page-link" href="javascript:void(0)" tabindex="-1" onclick="delegatUsersSecurityController.paginate(0)">
                        <i class="fa fa-angle-left"></i>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>`;$("#contactsPager").append(s);for(var t=0;t<n;t++)if(f<=t&&t<=r){let n="";t==i&&(n="active");let r=`<li class="page-item ${n}"><a class="page-link" href="javascript:void(0)" onclick="delegatUsersSecurityController.paginate(${t})">${t+1}</a></li>`;$("#contactsPager").append(r)}if(n>5){let t="",r="";n-1==i&&(r="disabled");t=`<li class="page-item ${r}">
                    <a class="page-link" href="javascript:void(0)" tabindex="-1" onclick="delegatUsersSecurityController.paginate(${n-1})">
                        <i class="fa fa-angle-right"></i>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>`;$("#contactsPager").append(t)}}},dynamicSort:function(n){var t=1;return n[0]==="-"&&(t=-1,n=n.substr(1)),function(i,r){var u=i[n]<r[n]?-1:i[n]>r[n]?1:0;return u*t}},search:function(n){let i=this;i.config.isSearchedBefore||(originalDelegatSecUsersList=[],originalDelegatSecUsersList=originalDelegatSecUsersList.concat(delegatSecUsersList),i.config.isSearchedBefore=!0);var t=$(n).val();t&&t.length>0?delegatSecUsersList=originalDelegatSecUsersList.filter(function(n){return String(n.FullName).toLowerCase().indexOf(t)>=0||String(n.Mobile).toLowerCase().indexOf(t)>=0||String(n.Email).toLowerCase().indexOf(t)>=0||String(n.IdNumber).toLowerCase().indexOf(t)>=0||String(n.EnglishName).toLowerCase().indexOf(t)>=0}):(delegatSecUsersList=[],delegatSecUsersList=originalDelegatSecUsersList.concat(delegatSecUsersList),originalDelegatSecUsersList=[],i.config.isSearchedBefore=!1);delegatSecUsersList.sort(i.dynamicSort("FullName"));i.config.pageIndex=0;i.rebuildGrid()},resetSearch:function(){ctrl.config.isSearchedBefore=!1;var n=$("#delegateSearchText").val();n&&n.length>0&&(delegatSecUsersList=[],delegatSecUsersList=originalDelegatSecUsersList.concat(delegatSecUsersList),originalDelegatSecUsersList=[])},searchListAdd:function(n){originalDelegatSecUsersList.splice(0,0,n)},searchListUpdate:function(n){const t=originalDelegatSecUsersList.map(n=>n.UserID).indexOf(n.UserID);t>=0&&(originalDelegatSecUsersList[t]=n)},searchListDelete:function(n){const t=originalDelegatSecUsersList.map(n=>n.UserID).indexOf(n.UserID);t>=0&&originalDelegatSecUsersList.splice(t,1)},bindGrid:function(){let n=this;$("#contactsGrid").empty();n.showNumber();delegatSecUsersList.sort(n.dynamicSort("FullName"));n.config.pageIndex=0;n.rebuildGrid();n.resetForm()}},delegationsController={foundation:null,controller:null,validator:delegationsValidations,contactsCtrl:delegatUsersController,addTestData:function(){jsonHelper.bindJsonToForm({IdNumber:"1234567890",BirthDate:"10-10-2020",BirthDateHijri:"1443-06-15",FullName:"الاسم بالكامل",Posission:"المنصب",Mobile:"0567121212",Email:"test@google.com",Tel:"0567121212"},$("#frmContactPerson"));$("#CrCountryID").change();$("#CountryID").change()},init:function(n){this.controller=n;accountValidations.registerEvents()},prepareForm:function(n){let i=this,t=$("#frmContactPerson");t.find("#BirthDate").css("display","block");t.find("#BirthDateHijri").css("display","none");t.find("#BirthDateHijri").addClass("hide_element");$("#dateType").change(function(){let n=$(this).val();n.startsWith("1")?(t.find("#BirthDateHijri").css("display","block"),t.find("#BirthDate").css("display","none"),t.find("#BirthDateHijri").removeClass("hide_element"),t.find("#BirthDate").addClass("hide_element"),t.find("#BirthDate").val(undefined)):(t.find("#BirthDate").css("display","block"),t.find("#BirthDateHijri").css("display","none"),t.find("#BirthDateHijri").addClass("hide_element"),t.find("#BirthDate").removeClass("hide_element"),t.find("#BirthDateHijri").val(undefined))});switch(n){case foundationType.BusinessInternal:$("#IdNumber").attr("type","idnumber");$("#Mobile").attr("type","mobile");break;case foundationType.ServiceProvider:$("#IdNumber").attr("type","idnumber");$("#Mobile").attr("type","mobile");break;case foundationType.Government:$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","nationalid");$("#Mobile").attr("type","mobile");break;case foundationType.Security:$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","nationalid");$("#Mobile").attr("type","mobile")}delegationsValidations.registerEvents()},loadData:function(n){let t=this;t.userAccounts=n;delegatUsersController.loadContactPersons(n)},submit:function(n,t){let u=this;t.preventDefault();let f=$(n),i=$("#frmFoundationAccount"),e=u.validator.validate(i);if(!e)return!1;f.prop("disabled",!0);let o=i.find(":input").not(".runtime-form").serializeAll(),r=formHelper.objectifyArray(o),s=i.attr("action");console.log("json",r);r.FoundationContacts=contactPersonsList;let h=JSON.stringify(r),c=formHelper.postAjax(s,h);c.done(function(n,t,i){f.prop("disabled",!1);n.status?(u.reset(),window.location="/Security/RegistrationCompleted"):alertHelper.dashboard.showResponse(n,t,i)})},reset:function(){let n=this;var t=globals.createGuid();$("textarea,input").not("#FoundationTypeId").val("");$('input[name="FoundationAccountId"]').val(t);contactPersonsList=[];n.contactsCtrl.showAdd();n.contactsCtrl.bindGrid()}},delegationsSecurityController={foundation:null,controller:null,validator:delegationsValidations,contactsCtrl:delegatUsersSecurityController,addTestData:function(){jsonHelper.bindJsonToForm({IdNumber:"1234567890",BirthDate:"10-10-2020",BirthDateHijri:"1443-06-15",FullName:"الاسم بالكامل",Posission:"المنصب",Mobile:"0567121212",Email:"test@google.com",Tel:"0567121212"},$("#frmContactPerson"));$("#CrCountryID").change();$("#CountryID").change()},init:function(n){this.controller=n;accountValidations.registerEvents()},prepareForm:function(n){let i=this,t=$("#frmContactPerson");t.find("#BirthDate").css("display","block");t.find("#BirthDateHijri").css("display","none");t.find("#BirthDateHijri").addClass("hide_element");$("#dateType").change(function(){let n=$(this).val();n.startsWith("1")?(t.find("#BirthDateHijri").css("display","block"),t.find("#BirthDate").css("display","none"),t.find("#BirthDateHijri").removeClass("hide_element"),t.find("#BirthDate").addClass("hide_element"),t.find("#BirthDate").val(undefined)):(t.find("#BirthDate").css("display","block"),t.find("#BirthDateHijri").css("display","none"),t.find("#BirthDateHijri").addClass("hide_element"),t.find("#BirthDate").removeClass("hide_element"),t.find("#BirthDateHijri").val(undefined))});switch(n){case foundationType.BusinessInternal:$("#IdNumber").attr("type","idnumber");$("#Mobile").attr("type","mobile");break;case foundationType.ServiceProvider:$("#IdNumber").attr("type","idnumber");$("#Mobile").attr("type","mobile");break;case foundationType.Government:$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","nationalid");$("#Mobile").attr("type","mobile");break;case foundationType.Security:$("#FoundationNo").attr("type","foundationnumber");$("#IdNumber").attr("type","nationalid");$("#Mobile").attr("type","mobile")}delegationsValidations.registerEvents()},loadData:function(n){let t=this;t.userAccounts=n;delegatUsersSecurityController.loadContactPersons(n)},submit:function(n,t){let u=this;t.preventDefault();let f=$(n),i=$("#frmFoundationAccount"),e=u.validator.validate(i);if(!e)return!1;f.prop("disabled",!0);let o=i.find(":input").not(".runtime-form").serializeAll(),r=formHelper.objectifyArray(o),s=i.attr("action");console.log("json",r);r.FoundationContacts=contactPersonsList;let h=JSON.stringify(r),c=formHelper.postAjax(s,h);c.done(function(n,t,i){f.prop("disabled",!1);n.status?(u.reset(),window.location="/Security/RegistrationCompleted"):alertHelper.dashboard.showResponse(n,t,i)})},reset:function(){let n=this;var t=globals.createGuid();$("textarea,input").not("#FoundationTypeId").val("");$('input[name="FoundationAccountId"]').val(t);contactPersonsList=[];n.contactsCtrl.showAdd();n.contactsCtrl.bindGrid()}},profileController={timerCount:90,isOTPDisplay:!1,isValueChange:!1,isDataChanged:!1,orgEmail:"",orgMobile:"",tryCounts:0,secureCodeTryTimes:0,timerObject:null,init:function(){$("#otpDIV").hide();profileController.orgEmail=$("#inputEmail").val();profileController.orgMobile=$("#MobileNumber").val();$("#inputEmail").change(function(){profileController.checkChange()});$("#MobileNumber").change(function(){profileController.checkChange()})},checkChange:function(){if($("#inputEmail").val()!=profileController.orgEmail){profileController.isValueChange=!0;profileController.isDataChanged=!0;return}if($("#MobileNumber").val()!=profileController.orgMobile){profileController.isValueChange=!0;profileController.isDataChanged=!0;return}profileController.isValueChange=!1},resendOTP:function(n,t){if(!(profileController.timerCount>0)){profileController.timerCount=90;let r=formHelper;t.preventDefault();let u=$(n),f=$(n.form);u.prop("disabled",!0);var i=null;let e=u.attr("action"),o=r.objectifyForm(f),s=JSON.stringify(o);i=r.postAjax(e,s);profileController.showOtpSection();i.done(function(n,t,i){profileController.secureCodeTryTimes=0;profileController.tryCounts=profileController.tryCounts+1;$("#hfSecOtp").val(n.data);$("#hfCounts").val(profileController.tryCounts);alertHelper.dashboard.showResponse(n,t,i,r.onSuccess)});i.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});i.always(function(){u.prop("disabled",!1)})}},sendOTP:function(n,t){let r=formHelper;t.preventDefault();let i=$(n),f=$(n.form),e=r.validateForm(f);if(!e)return!1;i.prop("disabled",!0);var u=null;let o=i.attr("actionOTP"),s=r.objectifyForm(f),h=JSON.stringify(s);u=r.postAjax(o,h);u.done(function(n,t,u){profileController.secureCodeTryTimes=0;i.prop("disabled",!1);profileController.showOtpSection();profileController.tryCounts=profileController.tryCounts+1;$("#hfSecOtp").val(n.data);$("#hfCounts").val(profileController.tryCounts);alertHelper.dashboard.showResponse(n,t,u,r.onSuccess)});u.fail(function(n,t,r){i.prop("disabled",!1);alertHelper.dashboard.showResponse(r,t,n)});u.always(function(){i.prop("disabled",!1)})},save:function(n,t){var r,e,o;if(!$("#frmForm").data("changed")){swal.fire(messagesData.NoDataChange,messagesData.NoDataChangeContent,"info");return}let i=formHelper;t.preventDefault();let u=$(n),f=$(n.form),s=i.validateForm(f);if(!s)return!1;if(profileController.isValueChange){profileController.sendOTP(n,t);profileController.isValueChange=!1;return}if(!profileController.isDataChanged){alertHelper.dashboard.error($("#hfNoDataChanged").val(),"");return}u.prop("disabled",!0);r=null;let h=f.attr("action"),c=i.objectifyForm(f),l=JSON.stringify(c);r=i.postAjax(h,l);r.done(function(n,t,r){u.prop("disabled",!1);n.errorMessages.length>0?(profileController.secureCodeTryTimes=profileController.secureCodeTryTimes+1,profileController.showOtpSection(),n.status=!1,n.message=n.errorMessages[0],alertHelper.dashboard.showResponse(n,n.errorMessages[0],r,i.onSuccess),profileController.secureCodeTryTimes>3&&(alertHelper.dashboard.error(AccountsValidationMessages.YouHaveReachMaximumTimesOfChangeData,""),window.location="/profile/Logout")):(n.status&&(profileController.secureCodeTryTimes=0,profileController.isDataChanged=!1,$("#frmForm").data("changed",!1),$("#Otp").val(""),$("#otpDIV").hide()),alertHelper.dashboard.showResponse(n,t,r,i.onSuccess))});r.fail(function(n,t,i){u.prop("disabled",!1);alertHelper.dashboard.showResponse(i,t,n)});r.always(function(){u.prop("disabled",!1)});profileController.isOTPDisplay||(e=$("#hfMobileNumber").val(),o=$("#MobileNumber").val(),o!=e&&profileController.showOtpSection())},showOtpSection:function(){profileController.isOTPDisplay=!0;$("#otpDIV").show();$("#otpCount").html(90);profileController.timerCount=90;profileController.timer()},timer:function(){profileController.timerObject&&clearTimeout(profileController.timerObject);profileController.timerObject=setTimeout(function(){profileController.timerCount=profileController.timerCount-1;profileController.timerCount>0?($("#otpCount").html(profileController.timerCount),profileController.timer()):$("#otpCount").html("")},1e3)}},passwordControler={timerCount:0,isOTPDisplay:!1,timerCount:0,tryCounts:0,isCurrentPasswordOpened:!1,init:function(){$("#otpSec").hide();$("#userSec").show()},OpenChnagePassword:function(){$("#chnagePasswordLik").hide();$(".password_input").show()},showCurrentPassword:function(){let n=this;n.isCurrentPasswordOpened=!0;$("#currentPassword").show()},ChangePasswordNew:function(n,t){t.preventDefault();let e=this;e.isCurrentPasswordOpened||e.showCurrentPassword();let i=formHelper,o=$(n),u=$(n.form),f=i.validateForm(u);if(!f||(f=i.validatePasswordAndConfermPassword("NewPasswordRep","NewPassword",[]),!f))return!1;o.prop("disabled",!0);var r=null;let s=u.attr("action"),h=i.objectifyForm(u),c=JSON.stringify(h);r=i.postAjax(s,c);r.done(function(n,t,r){n.status&&($("#OldPassword").val(""),$("#NewPassword").val(""),$("#NewPasswordRep").val(""),$("#password_input").hide(),$("#chnagePasswordLik").show(),$("#currentPassword").hide());alertHelper.dashboard.showResponse(n,t,r,i.onSuccess)});r.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});r.always(function(){o.prop("disabled",!1)})},ChangePassword:function(n,t){let e=this,i=formHelper;t.preventDefault();let f=$(n),u=$(n.form),o=i.validateForm(u);if(!o)return!1;f.prop("disabled",!0);var r=null;let s=u.attr("action"),h=i.objectifyForm(u),c=JSON.stringify(h);r=i.postAjax(s,c);r.done(function(n,t,r){n.status&&e.reset();alertHelper.dashboard.showResponse(n,t,r,i.onSuccess)});r.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});r.always(function(){f.prop("disabled",!1)})},SendOTP:function(n,t){t.preventDefault();let i=this;if(!(i.timerCount>0)){let r=formHelper,u=$(n),e=$(n.form),o=r.validateForm(e);if(!o)return!1;u.prop("disabled",!0);let s=u.attr("action"),h=r.objectifyForm(e),c=JSON.stringify(h),f=r.postAjax(s,c);f.done(function(n,t,r){if(n.status){i.showOtpSection();i.tryCounts=i.tryCounts+1;$("#hfSecOtp").val(n.data);$("#hfCounts").val(i.tryCounts);$("#OTP").attr("required","required");let t=$("#Mobile").val();$("#mobilePart").html(t.substr(t.length-3))}else alertHelper.dashboard.showResponse(n,t,r)});f.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});f.always(function(){u.prop("disabled",!1)})}},ReSendOTP:function(n,t){t.preventDefault();let i=this;if(!(i.timerCount>0)){let f=formHelper,r=$(n),e=$(n.form);r.prop("disabled",!0);let o=r.attr("action"),s=f.objectifyForm(e),h=JSON.stringify(s),u=f.postAjax(o,h);i.showOtpSection();u.done(function(n){i.tryCounts=i.tryCounts+1;$("#hfSecOtp").val(n.data);$("#hfCounts").val(i.tryCounts)});u.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});u.always(function(){r.prop("disabled",!1)})}},RestorePassword:function(n,t){let e=this;t.preventDefault();let i=formHelper,f=$(n),r=$(n.form),o=i.validateForm(r);if(!o)return!1;f.prop("disabled",!0);let s=r.attr("action"),h=i.objectifyForm(r),c=JSON.stringify(h),u=i.postAjax(s,c);u.done(function(n,t,r){n.status&&($("#otpSec").hide(),$("#userSec").show(),e.reset());alertHelper.dashboard.showResponse(n,t,r,i.onSuccess)});u.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});u.always(function(){f.prop("disabled",!1)})},showOtpSection:function(){let n=this;n.isOTPDisplay=!0;$("#otpSec").show();$("#userSec").hide();$("#spanResendOTP").show();$("#btnResendOTP").hide();$("#otpCount").html(60);n.timerCount=60;n.timer()},timer:function(){let n=this;setTimeout(function(){n.timerCount=n.timerCount-1;n.timerCount>0?($("#otpCount").html(n.timerCount),n.timer()):($("#spanResendOTP").hide(),$("#btnResendOTP").show(),$("#otpCount").html(""))},1e3)},login:function(n,t){let e=this,i=formHelper;t.preventDefault();let f=$(n),u=$(n.form),o=i.validateForm(u);if(!o)return!1;f.prop("disabled",!0);var r=null;let s=u.attr("action"),h=i.objectifyForm(u),c=JSON.stringify(h);r=i.postAjax(s,c);r.done(function(n,t,r){n.status&&e.reset();alertHelper.dashboard.showResponse(n,t,r,i.onSuccess)});r.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});r.always(function(){f.prop("disabled",!1)})},reset:function(){$("textarea,input").val("")}},loginControler={timerCount:0,isOTPDisplay:!1,timerCount:0,tryCounts:0,init:function(){$("#otpSec").hide();$("#userSec").show()},SendOTP:function(n,t){t.preventDefault();let i=this;if(!(i.timerCount>0)){let r=formHelper,u=$(n),e=$(n.form),o=r.validateForm(e);if(!o)return!1;u.addClass("btn-loading");let s=u.attr("action"),h=r.objectifyForm(e),c=JSON.stringify(h),f=r.postAjax(s,c);f.done(function(n,t,u){if(n.status){i.showOtpSection();i.tryCounts=i.tryCounts+1;$("#hfSecOtp").val(n.data);$("#hfCounts").val(i.tryCounts);$("#OTP").attr("required","required");let t=$("#Mobile").val();$("#mobilePart").html(t.substr(t.length-3))}else alertHelper.dashboard.showResponse(n,t,u,r.onSuccess)});f.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});f.always(function(){u.removeClass("btn-loading")})}},ReSendOTP:function(n,t){t.preventDefault();let i=this;if(!(i.timerCount>0)){let f=formHelper,r=$(n),e=$(n.form);r.addClass("btn-loading");let o=r.attr("action"),s=f.objectifyForm(e),h=JSON.stringify(s),u=f.postAjax(o,h);i.showOtpSection();u.done(function(n){i.tryCounts=i.tryCounts+1;$("#hfSecOtp").val(n.data);$("#hfCounts").val(i.tryCounts)});u.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});u.always(function(){r.removeClass("btn-loading")})}},showOtpSection:function(){let n=this;n.isOTPDisplay=!0;$("#otpSec").show();$("#btnSendOTP").hide();$("#btnLogin").show();$("#userSec").hide();$("#spanResendOTP").show();$("#btnResendOTP").hide();$("#otpCount").html(60);n.timerCount=60;n.timer()},hideOtpSection:function(){let n=this;n.isOTPDisplay=!1;$("#otpSec").hide();$("#btnSendOTP").show();$("#btnLogin").hide();$("#userSec").show();$("#spanResendOTP").hide();$("#btnResendOTP").show();$("#otpCount").html("");n.timerCount=0},login:function(n,t){let e=this,i=formHelper;t.preventDefault();let f=$(n),u=$(n.form),o=i.validateForm(u);if(!o)return!1;f.addClass("btn-loading");var r=null;let s=u.attr("action"),h=i.objectifyForm(u),c=JSON.stringify(h);r=i.postAjax(s,c);r.done(function(n,t,r){n.status&&e.reset();alertHelper.dashboard.showResponse(n,t,r,i.onSuccess)});r.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});r.always(function(){f.removeClass("btn-loading")})},timer:function(){let n=this;setTimeout(function(){n.timerCount=n.timerCount-1;n.timerCount>0?($("#otpCount").html(n.timerCount),n.timer()):($("#spanResendOTP").hide(),$("#btnResendOTP").show(),$("#otpCount").html(""))},1e3)},reset:function(){let n=this;n.hideOtpSection();$("textarea,input").val("")}},pollController={hasActivePoll:!1,isThereActivePollForUser:function(){$.ajax({url:"/Poll/IsThereActiveForClient",method:"Get",success:function(n){pollController.hasActivePoll=n.status==!0?!0:!1;pollController.hasActivePoll==!0&&$("#poll_box").show()},error:function(){}})},pollSave:function(n,t){t.preventDefault();let e=this,u=formHelper,i=$(n),f=$(n.form),o=e.validateForm(f);if(!o)return!1;i.prop("disabled",!0);let s=i.attr("action"),h=u.objectifyForm(f),c=JSON.stringify(h),r=u.postAjax(s,c);r.done(function(){window.location="/Poll/PollCompleted"});r.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});r.always(function(){i.prop("disabled",!1)})},validateForm:function(n){let t=!0,i=!0;return n.find("input,select,textarea,radio").each(function(){$(this).is(":visible")&&(i=$.validateInput(this),t&&!i&&(t=!1))}),t}},surveyController={prepareForm:function(){let n=this;n.hideAll();$("input[name=Question1]").change(function(){switch(this.value){case"1":case"2":case"3":n.hideAll();n.prepareQ1();break;default:n.hideAll()}});$("input[name=Question2]").change(function(){switch(this.value){case"1":case"2":case"3":n.prepareQ2(!0);break;default:n.prepareQ2(!1)}});$("input[name=Question5]").change(function(){switch(this.value){case"1":case"2":case"3":n.prepareQ5(!0);break;default:n.prepareQ5(!1)}});$("input[name=Question8]").change(function(){switch(this.value){case"1":case"2":case"3":n.prepareQ8(!0);break;default:n.prepareQ8(!1)}});$("input[name=Question11]").change(function(){switch(this.value){case"1":case"2":case"3":n.prepareQ11(!0);break;default:n.prepareQ11(!1)}})},hideAll:function(){$("#divQuestion2").hide();$("#divQuestion3").hide();$("#divQuestion4").hide();$("#divQuestion5").hide();$("#divQuestion6").hide();$("#divQuestion7").hide();$("#divQuestion8").hide();$("#divQuestion9").hide();$("#divQuestion10").hide();$("#divQuestion11").hide();$("#divQuestion12").hide();$("#divQuestion13").hide();$("#sepQuestion2").hide();$("#sepQuestion5").hide();$("#sepQuestion8").hide();$("#sepQuestion11").hide();$("input[name='Question2']").removeAttr("required");$("input[name='Question3']").removeAttr("required");$("input[name='Question4']").removeAttr("required");$("input[name='Question5']").removeAttr("required");$("input[name='Question6']").removeAttr("required");$("input[name='Question7']").removeAttr("required");$("input[name='Question8']").removeAttr("required");$("input[name='Question9']").removeAttr("required");$("input[name='Question10']").removeAttr("required");$("input[name='Question11']").removeAttr("required");$("input[name='Question12']").removeAttr("required");$("input[name='Question13']").removeAttr("required");$("input[name='Question2']").prop("checked",!1);$("input[name='Question3']").prop("checked",!1);$("input[name='Question4']").prop("checked",!1);$("input[name='Question5']").prop("checked",!1);$("input[name='Question6']").prop("checked",!1);$("input[name='Question7']").prop("checked",!1);$("input[name='Question8']").prop("checked",!1);$("input[name='Question9']").prop("checked",!1);$("input[name='Question10']").prop("checked",!1);$("input[name='Question11']").prop("checked",!1);$("input[name='Question12']").prop("checked",!1);$("input[name='Question13']").prop("checked",!1)},prepareQ1:function(){$("#divQuestion2").show();$("#divQuestion5").show();$("#divQuestion8").show();$("#divQuestion11").show();$("#sepQuestion2").show();$("#sepQuestion5").show();$("#sepQuestion8").show();$("#sepQuestion11").show();$("input[name='Question2']").attr("required","required");$("input[name='Question5']").attr("required","required");$("input[name='Question8']").attr("required","required");$("input[name='Question11']").attr("required","required")},prepareQ2:function(n){n?($("#divQuestion3").show(),$("#divQuestion4").show(),$("input[name='Question3']").attr("required","required"),$("input[name='Question4']").attr("required","required")):($("#divQuestion3").hide(),$("#divQuestion4").hide(),$("input[name='Question3']").removeAttr("required"),$("input[name='Question4']").removeAttr("required"),$("input[name='Question3']").prop("checked",!1),$("input[name='Question4']").prop("checked",!1))},prepareQ5:function(n){n?($("#divQuestion6").show(),$("#divQuestion7").show(),$("input[name='Question6']").attr("required","required"),$("input[name='Question7']").attr("required","required")):($("#divQuestion6").hide(),$("#divQuestion7").hide(),$("input[name='Question6']").removeAttr("required"),$("input[name='Question7']").removeAttr("required"),$("input[name='Question6']").prop("checked",!1),$("input[name='Question7']").prop("checked",!1))},prepareQ8:function(n){n?($("#divQuestion9").show(),$("#divQuestion10").show(),$("input[name='Question9']").attr("required","required"),$("input[name='Question10']").attr("required","required")):($("#divQuestion9").hide(),$("#divQuestion10").hide(),$("input[name='Question9']").removeAttr("required"),$("input[name='Question10']").removeAttr("required"),$("input[name='Question9']").prop("checked",!1),$("input[name='Question10']").prop("checked",!1))},prepareQ11:function(n){n?($("#divQuestion12").show(),$("#divQuestion13").show(),$("input[name='Question12']").attr("required","required"),$("input[name='Question13']").attr("required","required")):($("#divQuestion12").hide(),$("#divQuestion13").hide(),$("input[name='Question12']").removeAttr("required"),$("input[name='Question13']").removeAttr("required"),$("input[name='Question12']").prop("checked",!1),$("input[name='Question13']").prop("checked",!1))},surveySave:function(n,t){t.preventDefault();let e=this,i=formHelper,r=$(n),f=$(n.form),o=e.validateForm(f);if(!o)return!1;r.prop("disabled",!0);let s=r.attr("action"),h=i.objectifyForm(f),c=JSON.stringify(h),u=i.postAjax(s,c);u.done(function(n,t,r){n.status?window.location="/Survey/SurveyCompleted":alertHelper.dashboard.showResponse(n,t,r,i.onSuccess)});u.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});u.always(function(){r.prop("disabled",!1)})},validateForm:function(n){let t=!0,i=!0;return n.find("input,select,textarea,radio").each(function(){$(this).is(":visible")&&(i=$.validateInput(this),t&&!i&&(t=!1))}),t}},voteController={loadVote:function(){$.ajax({url:"/Vote/IndexContent",method:"Get",success:function(n){n.length>0&&($("#voteModalContent").html(n),voteController.openAnnounce())},error:function(){$loaderBox.css("visibility","hidden")}})},openAnnounce:function(){var n=$("#VoteIdPopup").val();n!="0"&&$("#poolModal").modal("show")},closeAnnounce:function(){$("#poolModal").modal("hide")},answerVote:function(n,t){t.preventDefault();let i=this,f=formHelper,r=$(n),e=$(n.form),o=i.validateForm(e);if(!o)return!1;r.prop("disabled",!0);let s=r.attr("action"),h=f.objectifyForm(e),c=JSON.stringify(h),u=f.postAjax(s,c);u.done(function(n,t,r){i.closeAnnounce();n.status&&i.closeAnnounce();alertHelper.dashboard.showResponse(n,t,r)});u.fail(function(n,t,i){alertHelper.dashboard.showResponse(i,t,n)});u.always(function(){r.prop("disabled",!1)})},validateForm:function(n){let t=!0,i=!0;return n.find("input,select,textarea,radio").each(function(){$(this).is(":visible")&&(i=$.validateInput(this),t&&!i&&(t=!1))}),t}},foundationAccountIntegrationController={select:function(n,t){t.preventDefault();let i=$(n),r=i.attr("foundationNo"),u=formHelper.postAjax("/FoundationAccount/Select/"+r,"");u.done(function(n,t,i){n.status?(delete_cookie("FoundationData"),document.location="/Services/Index"):alertHelper.dashboard.showResponse(n,t,i)})}};